<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Curious | AI Fishfinder Demo</title>

  <!-- Inline Critical Theme Styles -->
  <style>
    body.hidden {
      background-color: #D83B01; /* This should be your theme's background color */
      visibility: hidden; /* Hide until the script removes 'hidden' */
    }
    header {
      background-color: #BF3300; /* Theme header color */
      color: #FFFFFF; /* Theme text color */
    }
    a {
      color: #FFD7B5; /* Theme link color */
    }
  </style>

  <!-- Import the fallback styles -->
  <link rel="stylesheet" href="/2000/style.css">
  
  <!-- Include the script to load the dynamic theme -->
  <script src="/scripts/config.js" defer></script>


</head>

<body class="hidden">
  <header>
    <img id="site-logo" alt="Site Logo" style="display: none;">
    <h1 id="welcome-title">Curious - A.I. Fish ID Demo</h1>
  </header>

  <main>
    <!-- <h2 id="site-name">Try it out below</h2> -->

    <button type="button" onclick="init()">Start Demo</button>

    <div id="webcam-container"></div>
    <div id="label-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        const URL = "/2000/capture/model/";

        let model, webcam, labelContainer, maxPredictions;

        async function init() {
            try {
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";

                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                const flip = true;
                webcam = new tmImage.Webcam(300, 300, flip);
                await webcam.setup();
                await webcam.play();
                window.requestAnimationFrame(loop);

                document.getElementById("webcam-container").appendChild(webcam.canvas);
                labelContainer = document.getElementById("label-container");
                for (let i = 0; i < maxPredictions; i++) {
                    const labelDiv = document.createElement("div");
                    labelContainer.appendChild(labelDiv);
                }
            } catch (error) {
                console.error("Error initializing model or webcam:", error);
            }
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
    const predictions = await model.predict(webcam.canvas);
    labelContainer.innerHTML = ""; // Clear previous results
    for (let i = 0; i < maxPredictions; i++) {
        if (predictions[i].probability > 0.85) {
            const classPrediction = `${predictions[i].className}: ${(
                predictions[i].probability * 100
            ).toFixed(2)}%`;
            const resultDiv = document.createElement("div");
            resultDiv.textContent = classPrediction;
            labelContainer.appendChild(resultDiv);
        }
    }
}
    </script>

  </main>

  <div style="text-align: center;">
    <small><a href="./portal.html">Portal</a><br><br></small>
  </div>

  <small id="footer-version"></small>
  <footer>
    <a href="/index.html">
      <img src="/assets/images/logo.png" alt="Site Logo">
    </a>
    <!-- <br>
    <sub>Powered by Curious. All rights reserved.</sub> -->
  </footer>

</body>

</html>